{% extends "base.html" %}

{% block title %}Add New Patient - Ayurvedic Clinic{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="fas fa-user-plus"></i> Add New Patient</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-user-plus"></i> Patient Registration Form
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('add_patient_route') }}">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">Patient Name *</label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       placeholder="Enter full name" 
                                       value="{{ form_data.name if form_data else '' }}" required>
                            </div>
                            <div class="mb-3">
                                <label for="age" class="form-label">Age *</label>
                                <input type="number" class="form-control" id="age" name="age" 
                                       min="0" max="150" 
                                       value="{{ form_data.age if form_data and form_data.age else 30 }}" required>
                            </div>
                            <div class="mb-3">
                                <label for="gender" class="form-label">Gender *</label>
                                <select class="form-control" id="gender" name="gender" required>
                                    <option value="">Select Gender</option>
                                    <option value="Male" {{ 'selected' if form_data and form_data.gender == 'Male' else '' }}>Male</option>
                                    <option value="Female" {{ 'selected' if form_data and form_data.gender == 'Female' else '' }}>Female</option>
                                    <option value="Other" {{ 'selected' if form_data and form_data.gender == 'Other' else '' }}>Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="phone" class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" id="phone" name="phone" 
                                       placeholder="Enter 10-digit phone number" pattern="[0-9]{10}" 
                                       maxlength="10" value="{{ form_data.phone if form_data else '' }}" required>
                                <div class="form-text">Enter 10-digit phone number without spaces or dashes</div>
                            </div>
                            <div class="mb-3">
                                <label for="weight" class="form-label">Weight (kg)</label>
                                <input type="number" class="form-control" id="weight" name="weight" 
                                       step="0.1" min="0" placeholder="Enter weight in kg"
                                       value="{{ form_data.weight if form_data and form_data.weight else '' }}">
                                <div class="form-text">Optional - can be recorded during visits</div>
                            </div>
                            <div class="mb-3">
                                <label for="registration_date" class="form-label">Registration Date</label>
                                <input type="date" class="form-control" id="registration_date" 
                                       name="registration_date" value="{{ today }}">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="conditions" class="form-label">Medical Conditions</label>
                        <textarea class="form-control" id="conditions" name="conditions" rows="3" 
                                  placeholder="Enter any existing conditions (diabetes, hypertension, etc.)">{{ form_data.conditions if form_data else '' }}</textarea>
                        <div class="form-text">Optional - list any known medical conditions</div>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg me-3">
                            <i class="fas fa-save"></i> Add Patient
                        </button>
                        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Phone number validation
    document.getElementById('phone').addEventListener('input', function(e) {
        // Remove any non-digit characters
        this.value = this.value.replace(/[^0-9]/g, '');
        
        // Limit to 10 digits
        if (this.value.length > 10) {
            this.value = this.value.slice(0, 10);
        }
        
        // Visual feedback
        if (this.value.length === 10) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } else {
            this.classList.remove('is-valid');
            if (this.value.length > 0) {
                this.classList.add('is-invalid');
            }
        }
    });
</script>
{% endblock %}